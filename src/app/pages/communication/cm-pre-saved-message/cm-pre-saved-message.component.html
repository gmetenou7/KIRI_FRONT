<p-sidebar
  (onHide)="onDrawerHide()"
  [showCloseIcon] = "true"
  [dismissible]="false"
  [(visible)]="preSavedMessageDrawer"
  styleClass="w-full lg:w-9"
  position="right"
>
  <ng-template pTemplate="header">
    <div class="flex align-items-center">
      <span class="flex align-items-center justify-content-center bg-blue-100 text-blue-800 mr-3 border-circle"
            style="width:32px;height:32px">
        <i class="pi pi-comment text-lg"></i>
      </span>
      <span class="font-medium text-2xl text-900">
        Messages Pré-enregistrés
      </span>
    </div>
  </ng-template>
  <div class="flex flex-column justify-content-between min-h-full surface-ground p-2">
    <div class="scrollbar p-3">
    <div class="w-full flex justify-content-end mb-3">
      <button (click)="onShowNewMessageDrawer(); messageAsPreSaved=true" pButton pRipple icon="pi pi-plus" label="Nouveau message pré-enregistrré"></button>
    </div>
      <p-table scrollHeight="430px" class="scrollbar" [scrollable]="true" #dt1
               [value]="messages" dataKey="code" [rows]="10" [loading]="loadingMessages" [rowHover]="true"
               styleClass="p-datatable-gridlines scrollbar" [paginator]="true"
               [globalFilterFields]="['code','object','message']" responsiveLayout="scroll">
        <ng-template pTemplate="caption">
          <div class="flex flex-column gap-2">
            <div class="flex flex-column sm:flex-row gap-4">
              <div class="flex gap-2 w-full">
            <span class="p-input-icon-left mb-2 w-full">
              <i class="pi pi-search"></i>
              <input size="small" pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)"
                     placeholder="Chercher un message" class="w-full" />
            </span>
              </div>

            </div>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th style="min-width: 15rem">
              <div class="flex justify-content-between align-items-center">
                Objet
              </div>
            </th>
            <th style="min-width: 20rem">
              <div class="flex justify-content-between align-items-center">
                Message
              </div>
            </th>
            <th style="max-width: 10rem" class="text-center">
              Action
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-message>
          <tr>
            <td>
              <div class="flex flex-column gap-2">
                 <span class="font-semibold">
                    {{message.object | truncate : 20}}
                 </span>
              </div>
            </td>
            <td>
              <span class="ml-2">{{message.message | truncate : 70}}</span>
            </td>
            <td class="text-center">
              <div class="flex justify-content-between align-items-center gap-2">
                <a (click)="selectedMessage = message; onShowNewMessageDrawer()" href="javascript: void(0);" class="text-green-700 no-underline">
                  <i class="pi pi-send"></i>
                </a>
                <a (click)="selectedMessage = message; onShowMessageDetailDrawer()" href="javascript: void(0);" class="text-blue-700 no-underline">
                  <i class="pi pi-eye"></i>
                </a>
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8">Accun message trouvé.</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="8">Chargement en cours.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <div class="flex justify-content-end gap-4">
      <button pButton pRipple icon="pi pi-times" (click)="preSavedMessageDrawer =false" label="Fermer"></button>
    </div>
  </ng-template>
</p-sidebar>


<app-cm-message-detail
  [drawerVisible]="showMessageDetailDrawer"
  [selectMessage]="selectedMessage"
  (onDrawerClose)="onShowMessageDetailDrawer()"
  [isPreSaved]="true"
>

</app-cm-message-detail>

<app-cm-new-message
  (onDrawerClose)="onShowNewMessageDrawer(); selectedMessage=undefined; messageAsPreSaved = false"
  [drawerVisible]="showNewMessageDrawer"
  [preSavedMessage]="selectedMessage"
  [isPreSaved]="messageAsPreSaved"
>

</app-cm-new-message>

<p-sidebar
  (onHide)="onDrawerHide()"
  [showCloseIcon] = "true"
  [dismissible]="false"
  [(visible)]="clientsListDrawer"
  styleClass="w-full lg:w-9"
  position="right"
>
  <ng-template pTemplate="header">
    <div class="flex align-items-center gap-2">
      <span class="flex align-items-center justify-content-center bg-blue-100 text-blue-800 mr-3 border-circle"
            style="width:32px;height:32px">
        <i class="pi pi-users text-xl"></i>
      </span>
      <span class="font-medium text-2xl text-900">
        Liste des clients
      </span>
    </div>
  </ng-template>
  <div class="flex flex-column justify-content-between min-h-full surface-ground p-2">
    <div class="scrollbar p-2">
      <p-table [(selection)]="selectedClients" scrollHeight="480px" class="scrollbar" [scrollable]="true" #dt1
               [value]="clients" dataKey="code" [rows]="10" [loading]="loadingClient" [rowHover]="true"
               styleClass="p-datatable-gridlines scrollbar" [paginator]="true"
               [globalFilterFields]="['code', 'nom', 'prenom', 'email', 'telephone']" responsiveLayout="scroll">
        <ng-template pTemplate="caption">
          <div class="flex justify-content-between flex-column sm:flex-row">
            <div class="flex align-items-center gap-4">
              <div *ngIf="selectedClients && selectedClients.length > 0" class="flex align-items-center gap-2">
                <div class="flex gap-1">
                  <p-button (onClick)="onShowNewMessageDrawer()" size="small" label="Envoyer sessage" [badge]="
                    selectedClients.length > 0
                      ? selectedClients.length.toString()
                      : ''
                  " [loading]="loadingClient"></p-button>
                </div>
              </div>
            </div>
            <div class="flex gap-2">
            <span class="p-input-icon-left mb-2">
              <i class="pi pi-search"></i>
              <input size="small" pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)"
                     placeholder="Rechercher" class="w-20rem" />
            </span>
            </div>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pFrozenColumn style="width: 4rem">
              <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
            </th>
            <th pFrozenColumn style="min-width: 1rem">
              <div class="flex justify-content-between align-items-center">
                Code
              </div>
            </th>
            <th pFrozenColumn style="min-width: 10rem">
              <div class="flex justify-content-between align-items-center">
                Nom
              </div>
            </th>
            <th style="min-width: 10rem">
              <div class="flex justify-content-between align-items-center">
                Prénom
              </div>
            </th>
            <th style="min-width: 10rem">
              <div class="flex justify-content-between align-items-center">
                Tel
              </div>
            </th>
            <th style="min-width: 15rem">
              <div class="flex justify-content-between align-items-center">
                Email
              </div>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-client>
          <tr>
            <td pFrozenColumn>
              <p-tableCheckbox [value]="client"></p-tableCheckbox>
            </td>
            <td pFrozenColumn>
              {{ client.code }}
            </td>
            <td pFrozenColumn>
              <span class="ml-2">{{ client.nom }}</span>
            </td>
            <td>
              {{ client.prenom }}
            </td>
            <td>
              {{ client.telephone }}
            </td>
            <td>
              <span>{{ client.email }}</span>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8">Accun client trouvé.</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="8">Chargement en cours.</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <div class="flex justify-content-end gap-4">
      <button pButton pRipple icon="pi pi-times" (click)="clientsListDrawer =false" label="Fermer"></button>
    </div>
  </ng-template>
</p-sidebar>

<app-cm-new-message
  (onDrawerClose)="onShowNewMessageDrawer()"
  [drawerVisible]="showNewMessageDrawer"
  [selectedClients]="selectedClients"
>
</app-cm-new-message>
